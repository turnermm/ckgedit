function parse_wikitext(B){if(ckgedit_dwedit_reject){var f=GetE("ebut_cancel");f.click();return true}var z=setComplexTables();var s;function h(P){if(!z){return}var Q="";for(var O=0;O<P.length;O++){Q+="ROW"+O+"\n";for(var N=0;N<P[O].length;N++){Q+="["+N+"]";Q+="text="+P[O][N].text+" ";Q+="  type="+P[O][N].type+" ";Q+="  rowspan="+P[O][N].rowspan+"  ";Q+="  colspan="+P[O][N].colspan+"  "}Q+="\n"}s(Q,"show_rowspans");Q="";for(var O=0;O<P.length;O++){for(var N=0;N<P[O].length;N++){Q+="|"+P[O][N].text+" "}Q+="|\n"}s(Q,"show_rowspans")}function q(P,R,N,Q){var i="";try{s("row:"+R+",column:"+N+", rowspans:"+P[R][N].rowspan+", colspans:"+P[R][N].colspan+", text:"+P[R][N].text,Q)}catch(O){i+="row:"+R+",column:"+N}if(i){s(i,"not_found")}}function n(S,T,N){var Q=new Array();for(var P=T;P<S.length;P++){for(var O=0;O<S[P].length;O++){if(S[P][O].rowspan>0){var R=S[P][O].text;Q.push({row:P,column:O,spans:S[P][O].rowspan,text:R});if(!N){break}}}}return Q}function D(R,N,P,Q,i){var O=Q[R][N].colspan?Q[R][N].colspan:0;Q[R][N].rowspan=0;for(K=0;K<P-1;K++){Q[++R].splice(N,0,{type:"td",rowspan:0,colspan:O,prev_colspan:O,text:" ::: "})}}function y(S){var P=n(S,0,true);var N=P.length;if(!N){return false}var T=P[0].row;var O=P[0].column;D(T,O,P[0].spans,S);N--;for(var R=0;R<N;R++){T++;var Q=n(S,T,false);if(Q.length){D(Q[0].row,Q[0].column,Q[0].spans,S)}}return true}function m(Q){if(!z){return}for(var O=0;O<Q.length;O++){if(!y(Q)){break}}r+="\n";for(var O=0;O<Q.length;O++){r+="\n";for(var N=0;N<Q[O].length;N++){var P=Q[O][N].type=="td"?"|":"^";r+=P;var S=Q[O][N].align?Q[O][N].align:false;if(S=="center"||S=="right"){r+="  "}r+=Q[O][N].text;if(S=="center"||S=="left"){r+="  "}if(Q[O][N].colspan){for(var R=0;R<Q[O][N].colspan-1;R++){r+=P}}}r+="|"}}window.dwfckTextChanged=false;if(B!="bakup"){draft_delete()}var v="\nL_BR_K  \n";var E={b:"**",i:"//",em:"//",u:"__",br:v,strike:"<del>",del:"<del>",s:"<del>",p:"\n\n",a:"[[",img:"{{",strong:"**",h1:"\n====== ",h2:"\n===== ",h3:"\n==== ",h4:"\n=== ",h5:"\n== ",td:"|",th:"^",tr:" ",table:"\n\n",ol:"  - ",ul:"  * ",li:"",code:"''",pre:"\n<",hr:"\n\n----\n\n",sub:"<sub>",font:"\n",sup:"<sup>",div:"\n\n",span:"\n",dl:"\n",dd:"\n",dt:"\n"};var o={del:"</del>",s:"</del>",strike:"</del>",p:" ",br:" ",a:"]]",img:"}}",h1:" ======\n",h2:" =====\n",h3:" ====\n",h4:" ===\n",h5:" ==\n",td:" ",th:" ",tr:"|\n",ol:" ",ul:" ",li:"\n",pre:"\n</",sub:"</sub>",sup:"</sup> ",div:"\n\n",p:"\n\n",font:"\n\n</font> "};E.temp_u="CKGE_TMP_u";E.temp_strong="CKGE_TMP_strong";E.temp_em="CKGE_TMP_em";E.temp_i="CKGE_TMP_i";E.temp_b="CKGE_TMP_b";E.temp_del="CKGE_TMP_del";E.temp_strike="CKGE_TMP_strike";E.temp_code="CKGE_TMP_code";E.blank="";E.fn_start="((";E.fn_end="))";E.row_span=":::";E.p_insert="_PARA__TABLE_INS_";E.format_space="_FORMAT_SPACE_";E.pre_td="<";var u={strong:true,b:true,i:true,em:true,u:true,del:true,strike:true,code:true};var r="";var M=false;var t=false;var b=false;var J=false;var j=false;var H=false;var L=false;var I=false;var g=false;var G=false;var A;var c=new Array();var x=new Array();var e=false;var d=E.p_insert;var F="(br|co|coMULTI|es|kw|me|nu|re|st|sy)[0-9]";String.prototype.splice=function(i,O,N){return(this.slice(0,i)+N+this.slice(i+Math.abs(O)))};String.frasl=new RegExp("â„|&frasl;|&#8260;|&#x2044;","g");F=new RegExp(F);HTMLParser(CKEDITOR.instances.wiki__text.getData(),{attribute:"",link_title:"",link_class:"",image_link_type:"",td_align:"",in_td:false,td_colspan:0,td_rowspan:0,rowspan_col:0,last_column:-1,row:0,col:0,td_no:0,tr_no:0,current_row:false,in_table:false,in_multi_plugin:false,is_rowspan:false,list_level:0,prev_list_level:-1,list_started:false,xcl_markup:false,in_link:false,link_formats:new Array(),last_tag:"",code_type:false,in_endnotes:false,is_smiley:false,geshi:false,downloadable_code:false,export_code:false,code_snippet:false,downloadable_file:"",external_mime:false,in_header:false,curid:false,format_in_list:false,prev_li:new Array(),link_only:false,in_font:false,interwiki:false,bottom_url:false,font_family:"arial",font_size:"9pt",font_weight:"normal",font_color:"#000000",font_bgcolor:"#ffffff",font_style:"inherit",is_mediafile:false,backup:function(P,O){var R=r.lastIndexOf(P);var N=r.indexOf(O,R);if(R==-1||N==-1){return}if(P.length+N==N){var Q=r.substring(0,R);var i=r.substring(N);r=Q+i;return true}return false},is_iwiki:function(O,Q){var P=O.match(/iw_(\w+)/);var i=Q.split(/\//);var N=i[i.length-1];N=N.replace(String.frasl,"/");this.attr=P[1]+">"+N;this.interwiki=true},start:function(ap,W,ag){s=this.dbg;if(E[ap]){if(u[ap]&&this.in_link){this.link_formats.push(ap);return}if(u[ap]&&this.in_font){r+=" ";var al="temp_"+ap;r+=E[al];r+=" ";return}else{if(ap=="acronym"){return}}if(ap=="ol"||ap=="ul"){this.prev_list_level=this.list_level;this.list_level++;if(this.list_level==1){this.list_started=false}if(this.list_started){this.prev_li.push(E.li)}E.li=E[ap];return}else{if(!this.list_level){E.li="";this.prev_li=new Array()}}this.is_mediafile=false;if(ap=="img"){var ao="?";var N;var P;var aq=false;var ae="";var Z="";var af=false;this.is_smiley=false;this.in_link=false}if(ap=="a"){var ad=true;var ax="";this.xcl_markup=false;this.in_link=true;this.link_pos=r.length;this.link_formats=new Array();this.footnote=false;var X=false;this.id="";this.external_mime=false;var aw=false;this.export_code=false;this.code_snippet=false;this.downloadable_file="";var ab=false;this.link_only=false;save_url="";this.interwiki=false;this.bottom_url=false;this.link_title=false;var aj="";var aa=""}if(ap=="p"){this.in_link=false;if(this.in_table){ap="p_insert";J=true}}if(ap=="table"){this.td_no=0;this.tr_no=0;this.in_table=true;this.is_rowspan=false;this.row=-1;this.rows=new Array();A=this.rows;this.table_start=r.length}else{if(ap=="tr"){this.tr_no++;this.td_no=0;this.col=-1;this.row++;this.rows[this.row]=new Array();this.current_row=this.rows[this.row]}else{if(ap=="td"||ap=="th"){this.td_no++;this.col++;this.current_row[this.col]={type:ap,rowspan:0,colspan:0,text:""};this.cell_start=r.length;this.current_cell=this.current_row[this.col];if(this.td_rowspan&&this.rowspan_col==this.td_no&&this.td_no!=this.last_column){this.is_rowspan=true;this.td_rowspan--}else{this.is_rowspan=false}}}}var O;this.attr=false;this.format_tag=false;if(u[ap]){this.format_tag=true}var Y=false;for(var au=0;au<W.length;au++){if(ap=="td"||ap=="th"){if(W[au].name=="colspan"){this.current_row[this.col].colspan=W[au].value}if(W[au].name=="class"){if((O=W[au].value.match(/(left|center|right)/))){this.current_row[this.col].align=O[1]}}if(W[au].name=="rowspan"){this.current_row[this.col].rowspan=W[au].value}}if(W[au].escaped=="u"&&ap=="em"){ap="u";this.attr="u";break}if(ap=="div"){if(W[au].name=="class"&&W[au].value=="footnotes"){ap="blank";this.in_endnotes=true}break}if(ap=="dl"&&W[au].name=="class"&&W[au].value=="file"){this.downloadable_code=true;b=true;return}if(ap=="span"&&W[au].name=="class"){if(W[au].value=="np_break"){return}}if(ap=="span"&&W[au].name=="class"){if(W[au].value=="curid"){this.curid=true;return}if(W[au].value=="multi_p_open"){this.in_multi_plugin=true;L=true;return}if(W[au].value=="multi_p_close"){this.in_multi_plugin=false;return}if(W[au].value.match(F)){ap="blank";this.geshi=true;break}}if(ap=="span"){if(W[au].name=="style"){if(!this.in_font){r+="__STYLE__"}this.in_font=true;O=W[au].value.match(/font-family:\s*([\w\-\s,]+);?/);if(O){this.font_family=O[1]}O=W[au].value.match(/font-size:\s*(.*)/);if(O){O[1]=O[1].replace(/;/,"");this.font_size=O[1]}O=W[au].value.match(/font-weight:\s*(\w+);?/);if(O){this.font_weight=O[1]}O=W[au].value.match(/.*?color:\s*(.*)/);if(O){O[1]=O[1].replace(/;/,"");if(O[0].match(/background/)){this.font_bgcolor=O[1]}else{this.font_color=O[1]}}}}if(ap=="td"||ap=="th"){if(ap=="td"){r=r.replace(/\^$/,"|")}this.in_td=true;if(W[au].name=="align"){this.td_align=W[au].escaped}else{if(W[au].name=="class"){O=W[au].value.match(/\s*(\w+)align/);if(O){this.td_align=O[1]}}else{if(W[au].name=="colspan"){j=true;this.td_colspan=W[au].escaped}else{if(W[au].name=="rowspan"){this.td_rowspan=W[au].escaped-1;this.rowspan_col=this.td_no}}}}J=true}if(ap=="a"){if(W[au].name=="title"){this.link_title=W[au].escaped;if(aa){aj=W[au].escaped}else{this.link_title=this.link_title.replace(/\s+.*$/,"")}}else{if(W[au].name=="class"){if(W[au].value.match(/fn_top/)){this.footnote=true}else{if(W[au].value.match(/fn_bot/)){X=true}else{if(W[au].value.match(/mf_(png|gif|jpg|jpeg)/i)){this.link_only=true}}}this.link_class=W[au].escaped;aw=this.link_class.match(/mediafile/)}else{if(W[au].name=="id"){this.id=W[au].value}else{if(W[au].name=="type"){ax=W[au].value}else{if(W[au].name=="href"&&!this.code_type){var V=W[au].escaped.match(/https*:\/\//)?true:false;if(V){save_url=W[au].escaped}if(W[au].escaped.match(/\/lib\/exe\/detail.php/)){this.image_link_type="detail"}else{if(W[au].escaped.match(/exe\/fetch.php/)){this.image_link_type="direct"}}if(this.link_class&&this.link_class.match(/media/)&&!this.link_title){var ai=W[au].escaped.match(/media=(.*)/);if(ai){this.link_title=ai[1]}}var an=W[au].escaped.match(/fetch\.php.*?media=.*?\.(png|gif|jpg|jpeg)$/i);if(an){an=an[1]}if(W[au].escaped.match(/^https*:/)){this.attr=W[au].escaped;ad=false}if(W[au].escaped.match(/^ftp:/)){this.attr=W[au].escaped;ad=false}else{if(W[au].escaped.match(/do=export_code/)){this.export_code=true}else{if(W[au].escaped.match(/^nntp:/)){this.attr=W[au].escaped;ad=false}else{if(W[au].escaped.match(/^mailto:/)){this.attr=W[au].escaped.replace(/mailto:/,"");ad=false}else{if(W[au].escaped.match(/^file:/)){var Q=W[au].value.replace(/file:[\/]+/,"");Q=Q.replace(/[\/]/g,"\\");Q="\\\\"+Q;this.attr=Q;ad=false}else{if(V&&!an&&(O=W[au].escaped.match(/fetch\.php(.*)/))){if(O[1].match(/media=/)){U=O[1].split(/=/);this.attr=U[1]}else{O[1]=O[1].replace(/^\//,"");this.attr=O[1]}ad=false;this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr);if(!this.attr.match(/^:/)){this.attr=":"+this.attr}this.external_mime=true}else{ad=false;O=W[au].escaped.match(/doku.php\?id=(.*)/);if(!O){O=W[au].escaped.match(/doku.php\/(.*)/)}if(O){if(!O[1].match(/\?/)&&O[1].match(/&amp;/)){ab=true;O[1]=O[1].replace(/&amp;/,"?")}}if(O&&O[1]){if(!O[1].match(/^:/)){this.attr=":"+O[1]}else{this.attr=O[1]}if(this.attr.match(/\.\w+$/)){if(ax&&ax=="other_mime"){this.external_mime=true}else{for(var ar=au+1;ar<W.length;ar++){if(W[ar].value.match(/other_mime/)){this.external_mime=true}break}}}}else{O=W[au].value.match(/\\\\/);if(O){this.attr=W[au].escaped;ad=false}}}}}}}}if(this.link_class=="media"){if(W[au].value.match(/http:/)){ad=false}}if(!this.attr&&this.link_title){if(O=this.link_class.match(/media(.*)/)){this.link_title=decodeURIComponent(safe_convert(this.link_title));this.attr=this.link_title;var at=O[1].split(/_/);if(at&&at[1]){an=at[1]}else{if(at){an=at[0]}else{an="mf"}}if(!this.attr.match(/^:/)&&!this.attr.match(/^https?\:/)){this.attr=":"+this.attr.replace(/^\s+/,"")}this.external_mime=true;ad=false}}if(this.attr.match&&this.attr.match(/%[a-fA-F0-9]{2}/)&&(O=this.attr.match(/userfiles\/file\/(.*)/))){O[1]=O[1].replace(/\//g,":");if(!O[1].match(/^:/)){O[1]=":"+O[1]}this.attr=decodeURIComponent?decodeURIComponent(O[1]):unescape(O[1]);this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr);this.external_mime=true}if(this.link_title&&this.link_title.match(/Snippet/)){this.code_snippet=true}if(W[au].value.match(/^#/)&&this.link_class.match(/wikilink/)){this.attr=W[au].value;this.link_title=false}if(this.link_class.match(/wikilink/)&&this.link_title){this.external_mime=false;if(!this.attr){this.attr=this.link_title}if(!this.attr.match(/^:/)){this.attr=":"+this.attr}if(this.attr.match(/\?.*?=/)){var U=this.attr.split(/\?/);U[0]=U[0].replace(/\//g,":");this.attr=U[0]+"?"+U[1]}else{this.attr=this.attr.replace(/\//g,":")}if(!ab&&W[au].name=="href"){if(!this.attr.match(/\?.*?=/)&&!W[au].value.match(/doku.php/)){var av=W[au].value.match(/(\?.*)$/);if(av&&av[1]){this.attr+=av[1]}}}}else{if(this.link_class.match(/mediafile/)&&this.link_title&&!this.attr){this.attr=this.link_title;this.external_mime=true;if(!this.attr.match(/^:/)){this.attr=":"+this.attr}}else{if(this.link_class.match(/interwiki/)){aa=this.link_class}}}if(this.link_class=="urlextern"){this.attr=save_url;this.external_mime=false}if(this.in_endnotes){if(this.link_title){this.bottom_url=this.link_title}else{if(this.attr){this.bottom_url=this.attr}}}this.link_title="";this.link_class=""}}}}}}if(aa&&aj){this.is_iwiki(aa,aj);aa="";aj=""}if(ap=="sup"){if(W[au].name=="class"){O=W[au].value.split(/\s+/);if(O[0]=="dwfcknote"){this.attr=O[0];ap="blank";if(oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[O[1]]){Y="(("+oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[O[1]]+"))"}break}}}if(ap=="pre"){if(W[au].name=="class"){var U=W[au].escaped.split(/\s+/);if(U.length>1){this.attr=W[au].value;this.code_type=U[0]}else{this.attr=W[au].escaped;this.code_type=this.attr}if(this.downloadable_code){this.attr=this.attr.replace(/\s*code\s*/,"");this.code_type="file"}t=true;if(this.in_table){ap="pre_td"}break}}else{if(ap=="img"){if(W[au].name=="alt"){Z=W[au].value}if(W[au].name=="type"){this.image_link_type=W[au].value}if(W[au].name=="src"){var ah="";if(O=W[au].escaped.match(/fetch\.php.*?(media=.*)/)){var U=O[1].split("=");ah=U[1];if(O=W[au].escaped.match(/(media.*)/)){var U=O[1].split("=");var S=U[1];ah=decodeURIComponent?decodeURIComponent(S):unescape(S)}if(!ah.match(/https?:/)&&!ah.match(/^:/)){ah=":"+ah}}else{if(W[au].escaped.match(/https?:\/\//)){ah=W[au].escaped;ah=ah.replace(/\?.*?$/,"")}else{if(O=W[au].escaped.match(/\/_media\/(.*)/)){var U=O[1].split(/\?/);ah=U[0];ah=ah.replace(/\//g,":");if(!ah.match(/^:/)){ah=":"+ah}}else{if(O=W[au].escaped.match(/\/lib\/exe\/fetch.php\/(.*)/)){var U=O[1].split(/\?/);ah=U[0];if(!ah.match(/^:/)){ah=":"+ah}}else{O=W[au].escaped.match(/^.*?\/userfiles\/image\/(.*)/);if(!O){var R=doku_base+"data/media/";R=R.replace(/([\/\\])/g,"\\$1");R="^.*?"+R+"(.*)";R=new RegExp(R);O=W[au].escaped.match(R)}if(O&&O[1]){ah=O[1].replace(/\//g,":");ah=":"+ah}else{ah=decodeURIComponent?decodeURIComponent(W[au].escaped):unescape(W[au].escaped);if(ah.search(/data:image.*?;base64/)>-1){af=true}}if(ah&&ah.match(/lib\/images\/smileys/)){this.is_smiley=true}}}}}this.attr=ah;if(this.attr&&this.attr.match&&this.attr.match(/%[a-fA-F0-9]{2}/)){this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr);this.attr=decodeURIComponent?decodeURIComponent(this.attr):unescape(this.attr)}}else{if(W[au].name=="width"&&!aq){N=W[au].value}else{if(W[au].name=="height"&&!aq){P=W[au].value}else{if(W[au].name=="style"){var T=W[au].escaped.match(/width:\s*(\d+)/);if(T){N=T[1];var T=W[au].escaped.match(/height:\s*(\d+)/);if(T){P=T[1]}}}else{if(W[au].name=="align"||W[au].name=="class"){if(W[au].escaped.match(/(center|middle)/)){ae="center"}else{if(W[au].escaped.match(/right/)){ae="right"}else{if(W[au].escaped.match(/left/)){ae="left"}else{ae=""}}}}}}}}}}}if(this.is_smiley){if(Z){r+=Z+" ";Z=""}this.is_smiley=false;return}if(this.link_only){ap="img"}if(ap=="br"){if(this.in_multi_plugin){r+="\n";return}if(!this.code_type){M=true}else{if(this.code_type){r+="\n";return}}if(this.in_table){r+=d;return}if(this.list_started){r+="_LIST_EOFL_"}else{r+="\\\\  ";return}}else{if(ap.match(/^h(\d+|r)/)){var ac=r.length;if(ap.match(/h(\d+)/)){this.in_header=true}if(ac){if(r.charCodeAt(ac-1)==32){r=r.replace(/\x20+$/,"")}}}else{if(this.last_col_pipes){if(u[ap]){r+=E[ap]}ap="blank"}else{if(Y){r+=Y;return}}}}if(ap=="b"||ap=="i"&&this.list_level){if(r.match(/(\/\/|\*)(\x20)+/)){r=r.replace(/(\/\/|\*)(\x20+)\-/,"$1\n$2-")}}if(ap=="li"&&this.list_level){if(this.list_level==1&!this.list_started){r+="\n";this.list_started=true}r=r.replace(/[\x20]+$/,"");for(var am=0;am<this.list_level;am++){if(r.match(/_FORMAT_SPACE_\s*$/)){r=r.replace(/_FORMAT_SPACE_\s*$/,"\n")}if(this.list_level>1){r+="  "}}if(this.prev_list_level>0&&E.li==E.ol){this.prev_list_level=-1}}if(ap=="a"&&ad){this.xcl_markup=true;return}else{if(ap=="a"&&(this.export_code||this.code_snippet)){return}else{if(ap=="a"&&this.footnote){ap="fn_start"}else{if(ap=="a"&&X){c.push(this.id)}else{if(ap=="a"&&this.external_mime){if(this.in_endnotes){this.link_class="media";return}if(aw&&aw=="mediafile"){r+=E.img;r+=this.attr+"|";this.is_mediafile=true}return}else{if(this.in_font){return}}}}}}if(this.in_endnotes&&ap=="a"){return}if(this.code_type&&ap=="span"){ap="blank"}r+=E[ap];if(ap=="td"||ap=="th"||(this.last_col_pipes&&this.td_align=="center")){if(this.is_rowspan){r+=E.row_span+" | ";this.is_rowspan=false}if(this.td_align=="center"||this.td_align=="right"){r+="  "}}else{if(ap=="a"&&this.attr){this.attr=this.attr.replace(/%7c/,"%257c");r+=this.attr+"|"}else{if(ap=="img"){var ak=this.image_link_type;this.image_link_type="";if(this.link_only){ak="link_only"}if(!ak||af){ak="nolink"}else{if(ak=="detail"){ak=""}}if(ak=="link_only"){ao="?linkonly"}else{if(ak){ao+=ak+"&"}}if(N&&P){ao+=N+"x"+P}else{if(N){ao+=N}else{if(!ak){ao=""}}}if(ae&&ae!="left"){r+="  "}this.attr+=ao;if(ae=="center"||ae=="left"){this.attr+="  "}r+=this.attr+"}}";this.attr="src"}else{if(ap=="pre"||ap=="pre_td"){if(this.downloadable_file){this.attr+=" "+this.downloadable_file}if(!this.attr){this.attr="code"}r+=this.attr+">";this.downloadable_file="";this.downloadable_code=false}}}}}},end:function(ac){if(u[ac]&&this.in_font){r+=" ";var ab="temp_"+ac;r+=E[ab];r+=" ";return}if(this.in_endnotes&&ac=="a"){return}if(this.link_only){this.link_only=false;return}if(!E[ac]){return}if(ac=="sup"&&this.attr=="dwfcknote"){return}if(this.is_smiley){this.is_smiley=false;if(ac!="li"){return}}if(ac=="span"&&this.in_font){ac="font";var X="<font "+this.font_size+"/"+this.font_family+";;"+this.font_color+";;"+this.font_bgcolor+">\n\n";var T=r.lastIndexOf("__STYLE__");r=r.splice(T,9,X);this.font_family="arial";this.font_size="9pt";this.font_weight="normal";this.font_color="#000000";this.font_bgcolor="#ffffff";this.in_font=false}if(ac=="span"&&this.curid){this.curid=false;return}if(ac=="dl"&&this.downloadable_code){this.downloadable_code=false;return}if(z&&(ac=="td"||ac=="th")){this.current_cell.text=r.substring(this.cell_start);this.current_cell.text=this.current_cell.text.replace(/:::/gm,"");this.current_cell.text=this.current_cell.text.replace(/^[\s\|\^]+/,"")}if(ac=="a"&&(this.export_code||this.code_snippet)){this.export_code=false;this.code_snippet=false;return}if(this.code_type&&ac=="span"){ac="blank"}var Z=ac;if(this.footnote){ac="fn_end";this.footnote=false}else{if(ac=="a"&&this.xcl_markup){this.xcl_markup=false;return}else{if(ac=="table"){this.in_table=false;if(z){r=r.substring(0,this.table_start);m(this.rows)}}}}if(ac=="p"&&this.in_table){ac="p_insert";J=true}if(this.geshi){this.geshi=false;return}if(ac=="code"&&!this.list_started){if(r.match(/''\s*$/m)){r=r.replace(/''\s*$/,"\n");return}}else{if(ac=="a"&&this.attr=="src"){if(this.backup("[[","{")){return}}}if(ac=="ol"||ac=="ul"){this.list_level--;if(!this.list_level){this.format_in_list=false}if(this.prev_li.length){E.li=this.prev_li.pop()}ac="\n\n"}else{if(ac=="a"&&this.external_mime){this.external_mime=false;if(this.is_mediafile){ac="}} "}else{return}}else{if(ac=="pre"){ac=o[ac];if(this.code_type){ac+=this.code_type+">"}else{var O=r.lastIndexOf("code");var Q=r.lastIndexOf("file");if(Q>O){this.code_type="file"}else{this.code_type="code"}ac+=this.code_type+">"}this.code_type=false}else{if(o[ac]){ac=o[ac]}else{if(this.attr=="u"&&ac=="em"){ac="u"}else{if(ac=="acronym"){}else{ac=E[ac]}}}}}}if(Z=="tr"){if(this.last_col_pipes){ac="\n";this.last_col_pipes=""}if(this.td_rowspan&&this.rowspan_col==this.td_no+1){this.is_rowspan=false;this.last_column=this.td_no;this.td_rowspan--;ac="|"+E.row_span+"|\n"}}else{if(Z=="td"||Z=="th"){this.last_col_pipes="";this.in_td=false}else{if(Z.match(/h\d+/)){this.in_header=false}}}if(E.li){if(r.match(/\n$/)){ac=""}}if(this.in_link&&u[Z]&&this.link_formats.length){return}r+=ac;if(u[Z]){if(this.list_level){this.format_in_list=true;g=true}r+=E.format_space;H=E.format_space}this.last_tag=Z;if(this.td_colspan&&!z){if(this.td_align=="center"){r+=" "}var P="|";if(Z=="th"){P="^"}var S=P;for(var U=1;U<this.td_colspan;U++){S+=P}this.last_col_pipes=S;r+=S;this.td_colspan=false}else{if(this.td_align=="center"){r+=" ";this.td_align=""}}if(Z=="a"&&this.link_formats.length){var aa=r.substring(this.link_pos);var V=r.substring(0,this.link_pos);var N="";var Y="";for(var U=0;U<this.link_formats.length;U++){var R=E[this.link_formats[U]];var W=o[this.link_formats[U]]?o[this.link_formats[U]]:R;N+=E[this.link_formats[U]];Y=W+Y}V+=N;aa+=Y;r=V+aa;this.link_formats=new Array();this.in_link=false}else{if(Z=="a"){this.link_formats=new Array();this.in_link=false}}},chars:function(Q){Q=Q.replace(/\t/g,"    ");if(this.interwiki){Q=Q.replace(String.frasl,"/")}if(this.interwiki&&r.match(/>\w+\s*\|$/)){this.interwiki=false;if(this.attr){r+=Q}else{r=r.replace(/>\w+\s*\|$/,">"+Q)}return}if(this.in_multi_plugin){Q=Q.replace("&lt; ","&lt;")}Q=Q.replace(/&#39;/g,"'");Q=Q.replace(/^(&gt;)+/,function(S,R){return(S.replace(/(&gt;)/g,"__QUOTE__"))});r=r.replace(/([\/\*_])_FORMAT_SPACE_([\/\*_]{2})_FORMAT_SPACE_$/,"$1$2");if(Q.match(/^&\w+;/)){r=r.replace(/_FORMAT_SPACE_\s*$/,"")}if(this.link_only){if(Q){replacement="|"+Q+"}} ";r=r.replace(/\}\}\s*$/,replacement)}return}if(!this.code_type){if(!this.last_col_pipes){Q=Q.replace(/\x20{6,}/,"   ");Q=Q.replace(/^(&nbsp;)+\s*$/,"_FCKG_BLANK_TD_");Q=Q.replace(/(&nbsp;)+/," ")}if(this.format_tag){if(!this.list_started||this.in_table){Q=Q.replace(/^\s+/,"@@_SP_@@")}}else{if(this.last_tag=="a"){Q=Q.replace(/^\s{2,}/," ")}else{Q=Q.replace(/^\s+/,"")}}if(Q.match(/nowiki&gt;/)){I=true}if(this.format_in_list){Q=Q.replace(/^[\n\s]+$/g,"");if(Q.match(/\n{2,}\s{1,}/)){Q=Q.replace(/\n{2,}/,"\n")}}if(this.in_td&&!Q){Q="_FCKG_BLANK_TD_";this.in_td=false}}else{Q=Q.replace(/&lt;\s/g,"<");Q=Q.replace(/\s&gt;/g,">");var i=Q.match(/^\s*geshi:\s+(.*)$/m);if(i){r=r.replace(/<(code|file)>\s*$/,"<$1 "+i[1]+">");Q=Q.replace(i[0],"")}}if(this.attr&&this.attr=="dwfcknote"){if(Q.match(/fckgL\d+/)){return}if(Q.match(/^[\-,:;!_]/)){r+=Q}else{r+=" "+Q}return}if(this.downloadable_code&&(this.export_code||this.code_snippet)){this.downloadable_file=Q;return}if(this.last_tag=="a"&&Q.match(/^[\.,;\:\!]/)){r=r.replace(/\s$/,"")}if(this.in_header){Q=Q.replace(/---/g,"&mdash;");Q=Q.replace(/--/g,"&ndash;")}if(this.list_started){r=r.replace(/_LIST_EOFL_\s*L_BR_K\s*$/,"_LIST_EOFL_")}if(!this.code_type){if(!r.match(/\[\[\\\\.*?\|$/)&&!Q.match(/\w:(\\(\w?))+/)){if(!Q.match(/\\\\[\w\.\-\_]+\\[\w\.\-\_]+/)){Q=Q.replace(/([\\])/g,"%%$1%%")}Q=Q.replace(/([\*])/g,"_CKG_ASTERISK_")}}if(this.in_endnotes&&c.length){if(Q.match(/\w/)&&!Q.match(/^\s*\d\)\s*$/)){Q=Q.replace(/\)\s*$/,"_FN_PAREN_C_");var N=c.length-1;if(this.bottom_url){if(this.link_class&&this.link_class=="media"){Q="{{"+this.bottom_url+"|"+Q+"}}"}else{Q="[["+this.bottom_url+"|"+Q+"]]"}}if(x[c[N]]){x[c[N]]+=" "+Q}else{x[c[N]]=Q}}this.bottom_url=false;return}if(Q&&Q.length){r+=Q}r=r.replace(/(&\w+;)\s*([\*\/_]{2})_FORMAT_SPACE_(\w+)/,"$1$2$3");if(this.list_level&&this.list_level>1){r=r.replace(/(\[\[.*?\]\])([ ]+[\*\-].*)$/," $1\n$2")}try{var P=new RegExp("([*/_]{2,})_FORMAT_SPACE_([*/_]{2,})("+RegExp.escape(Q)+")$");if(r.match(P)){r=r.replace(P,"$1$2$3")}}catch(O){}if(!e){if(Q.match(/&lt;/)){e=true}}},comment:function(i){},dbg:function(N,i){if(N.replace){N=N.replace(/^\s+/g,"");N=N.replace(/^\n$/g,"");if(!N){return}}if(i){i="<b>"+i+"</b>\n"}HTMLParser_DEBUG+=i+N+"\n__________\n"}});r=r.replace(/(\[\[\\\\)(.*?)\]\]/gm,function(i,O,N){N=N.replace(/\\/g,"_SMB_");return O+N+"]]"});r=r.replace(/%*\\%*([^\w]{1})%*\\%*/g,"$1");r=r.replace(/_SMB_/g,"\\");r=r.replace(/CKGE_TMP_(\w+)/gm,function(N,i){if(i=="b"){return"**"}if(i=="em"){return"//"}if(i=="u"){return"__"}if(i=="code"){return"''"}return""});if(B=="test"){if(!HTMLParser_test_result(r)){return}}r=r.replace(/\{ \{ rss&gt;Feed:/mg,"{{rss&gt;http://");r=r.replace(/~ ~ (NOCACHE|NOTOC)~ ~/mg,"~~$1~~");if(H){if(j){r=r.replace(/\s*([\|\^]+)((\W\W_FORMAT_SPACE_)+)/gm,function(i,N,O){O=O.replace(/_FORMAT_SPACE_/g,"");return(O+N)})}r=r.replace(/&quot;/g,'"');var k=new RegExp(H+"([\\-]{2,})","g");r=r.replace(k," $1");var k=new RegExp("(\\w|\\d)(\\*\\*|\\/\\/|\\'\\'|__|</del>)"+H+"(\\w|\\d)","g");r=r.replace(k,"$1$2$3");var k=new RegExp(H+"@@_SP_@@","g");r=r.replace(k," ");r=r.replace(/([\*\/_]{2})@@_SP_@@(&\w+;)/g,"$1 $2");r=r.replace(/\n@@_SP_@@\n/g,"");r=r.replace(/@@_SP_@@\n/g,"");r=r.replace(/@@_SP_@@/g," ");var k=new RegExp(H+"([^\\)\\]\\}\\{\\-\\.,;:\\!?\"\x94\x92\u201D\u2019'])","g");r=r.replace(k," $1");k=new RegExp(H,"g");r=r.replace(k,"");if(g){r=r.replace(/(\s+[\-\*_]\s*)([\*\/_\']{2})(.*?)(\2)([^\n]*)\n+/gm,function(O,i,Q,R,N,P){return(i+Q+R+N+P+"\n")})}}var p="\\\\";if(M){r=r.replace(/(L_BR_K)+/g,p);r=r.replace(/L_BR_K/gm,p);r=r.replace(/(\\\\)\s+/gm,"$1 \n")}if(t){r=r.replace(/\s+<\/(code|file)>/g,"\n</$1>");if(b){r=r.replace(/\s+;/mg,";");r=r.replace(/&lt;\s+/mg,"<");r=r.replace(/\s+&gt;/mg,">")}}if(J){r+="\n"+p+"\n";var k=new RegExp(d,"g");r=r.replace(k," "+p+" ");r=r.replace(/(\||\^)[ ]+(\||\^)\s$/g,"$1\n");r=r.replace(/(\||\^)[ ]+(\||\^)/g,"$1")}r=r.replace(/_FCKG_BLANK_TD_/g," ");if(e){r=r.replace(/\/\/&lt;\/\/\s*/g,"&lt;")}if(c.length){r=r.replace(/<sup>\(\(\){2,}\s*<\/sup>/g,"");r=r.replace(/\(\(+(\d+)\)\)+/,"(($1))");for(var K in x){var a=K.match(/_(\d+)/);var l=new RegExp("(<sup>)*[(]+"+a[1]+"[)]+(</sup>)*");r=r.replace(l,"(("+x[K].replace(/_FN_PAREN_C_/g,") ")+"))")}r=r.replace(/<sup><\/sup>/g,"");r=r.replace(/((<sup>\(\(.*\)\)\)?<\/sup>))/mg,function(i){if(!i.match(/p>\(\(\d+/)){return""}return i})}r=r.replace(/(={3,}.*?)(\{\{.*?\}\})(.*?={3,})/g,"$1$3\n\n$2");r=r.replace(/(<sup>)*\s*\[\[\s*\]\]\s*(<\/sup>)*\n*/g,"");r=r.replace(/<sup>(.*?)(\(\(.*\)\))\s*<\/sup>/mg,"$1$2");if(L){r=r.replace(/<\s+/g,"<");r=r.replace(/&lt;\s+/g,"<")}if(I){var w="%";var k=new RegExp("(["+w+"])","g");r=r.replace(/(&lt;nowiki&gt;)(.*?)(&lt;\/nowiki&gt;)/mg,function(N,P,i,O){i=i.replace(/%%(.)%%/mg,"NOWIKI_$1_");return P+i.replace(k,"NOWIKI_$1_")+O})}r=r.replace(/SWF(\s*)\[*/g,"{{$1");r=r.replace(/\|.*?\]*(\s*)FWS/g,"$1}}");r=r.replace(/(\s*)FWS/g,"$1}}");r=r.replace(/\n{3,}/g,"\n\n");r=r.replace(/_LIST_EOFL_/gm," "+p+" ");if(embedComplexTableMacro){if(r.indexOf("~~COMPLEX_TABLES~~")==-1){r+="~~COMPLEX_TABLES~~\n"}}r=r.replace(/_CKG_ASTERISK_/gm,"*");if(B=="test"){if(HTMLParser_test_result(r)){alert(r)}return}var C=GetE("dw__editform");C.elements.fck_wikitext.value=r;if(B=="bakup"){return}if(B){var f=GetE(B);f.click();return true}};